(function(){var i=function(){};i.prototype.isCancellation=!0;var l=0,k=typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports,f=function(c,g){g||(g=c);g.binders&&(g.binders.async="$await");if(!c.modules)c.modules={};if(!c.modules.async){var f=function(){};f.prototype={register:function(a){this.isCancellationRequested&&a();if(!this._handlers)this._handlers=[];this._handlers.push(a)},unregister:function(a){this._handlers&&(a=this._handlers.indexOf(a),a>=0&&this._handlers.splice(a,
1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=!0;var a=this._handlers;delete this._handlers;for(var b=0;b<a.length;b++)try{a[b]()}catch(d){c.log("WARNING: Cancellation handler threw an error: "+d)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new i;}};var j=function(a){this.id=(++l).toString();this._delegate=a;this._listeners={};this.status="ready"};j.prototype={start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');
var a=this;this.status="running";this._delegate.onStart(function(b,d){if(a.status!="running")throw Error('Callback can only be used in "running" status.');if(b=="success")a.result=d,a.status="succeeded",a._notify("success");else if(b=="failure")a.error=d,a.status=d.isCancellation?"canceled":"failed",a._notify("failure");else throw Error("Unsupported type: "+b);a._notify("complete");delete a._listeners})},_notify:function(a){var b=this._listeners[a];if(b)for(var d=0;d<b.length;d++)try{b[d](this)}catch(m){c.log("WARNING: the task's "+
a+" listener threw an error: "+m)}},addEventListener:function(a,b){if(!this._listeners)throw Error('Listeners can only be added in "ready" or "running" status.');this._listeners[a]||(this._listeners[a]=[]);this._listeners[a].push(b)},removeEventListener:function(a,b){if(!this._listeners)throw Error('Listeners can only be removed in "ready" or "running" status.');var d=this._listeners[a];if(d){var c=d.indexOf(b);c>=0&&d.splice(c,1)}}};var e=function(){};e.prototype={Start:function(a,b){return new j({onStart:function(d){b.next(a,
function(a,b){if(a=="normal"||a=="return")d("success",b);else if(a=="throw")d("failure",b);else throw Error("Unsupported type: "+a);})}})},Bind:function(a,b){return{next:function(d,c){var e=function(a){if(a.error)c("throw",a.error);else{var e;try{e=b.call(d,a.result)}catch(f){c("throw",f);return}e.next(d,c)}};a.status=="ready"?(a.addEventListener("complete",e),a.start()):a.status=="running"?a.addEventListener("complete",e):e(a)}}}};k?require("./jscex-builderbase").standardizeBuilder(e.prototype):
c.standardizeBuilder(e.prototype);if(!c.Async)c.Async={};var h=c.Async;h.CancellationToken=f;h.CanceledError=i;h.Task=j;h.Builder=e;if(!c.builders)c.builders=[];c.builders.async=new e;c.modules.async=!0}};k?module.exports.init=f:f(Jscex)})();
