(function(){var g=function(d){if(!d.modules||!d.modules["async-powerpack"]){if(!d.modules||!d.modules.async)throw Error('Missing essential component, please initialize "jscex-async" module first.');var i=d.Async,j=i.Task,g=i.CanceledError;i.sleep=function(b,c){return new j({onStart:function(e){c&&c.throwIfCancellationRequested();var f,a;c&&(a=function(){clearTimeout(f);e("failure",new g)});f=setTimeout(function(){c&&c.unregister(a);e("success")},b);c&&c.register(a)}})};i.onEvent=function(b,c,e){return new j({onStart:function(f){e&&
e.throwIfCancellationRequested();var a,d;e&&(d=function(){b.removeEventListener?b.removeEventListener(c,a):b.detachEvent(c,a);f("failure",new g)});a=function(a){e&&e.unregister(d);f("success",a)};b.addEventListener?b.addEventListener(c,a):b.attachEvent(c,a);e&&e.register(d)}})};j.whenAll=function(b){return new j({onStart:function(c){for(var e={},f=[],a=0;a<b.length;a++)e[b[a].id]=a,f.push(h);var d=[],g=function(a){if(a.error){for(var b=0;b<tasksClone.length;b++)f[b].removeListener(g);c("failure",
a.error)}else d[e[a.id]]=a.result,a=f.indexOf(a),f.splice(a,1),f.length==0&&(finished=!0,c("success",d))};for(a=0;a<b.length;a++){var h=b[a];switch(h.status){case "ready":h.addEventListener("complete",g);h.start();break;case "running":h.addEventListener("complete",g);break;default:g(h)}}}})};d.modules["async-powerpack"]=!0}};typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports?module.exports.init=g:g(Jscex)})();
