(function(){var m=function(j){if(j.length<=1)return null;for(var g=[],f=1;f<j.length;f++)g.push(j[f]);return g},n=function(j,g){for(var f=[],k=0;k<j.length;k++)f.push(j[k]);for(;f.length<g;)f.push(void 0);return f},l=function(j){if(!j.modules["async-powerpack"]){if(!j.modules.async)throw Error('Missing essential components, please initialize "jscex-async" module first.');var g=j.Async,f=g.Task,k=g.CanceledError;g.sleep=function(b,a){return f.create(function(d){a&&a.isCancellationRequested&&d.complete("failure",
new k);var e,c;a&&(c=function(){clearTimeout(e);d.complete("failure",new k)});e=setTimeout(function(){a&&a.unregister(c);d.complete("success")},b);a&&a.register(c)})};g.onEvent=function(b,a,d){return f.create(function(e){d&&d.isCancellationRequested&&e.complete("failure",new k);var c=function(){b.removeEventListener?b.removeEventListener(a,h):b.removeListener?b.removeListener(a,h):b.detachEvent(a,h)},h,i;d&&(i=function(){c();e.complete("failure",new k)});h=function(b){d&&d.unregister(i);c();e.complete("success",
b)};b.addEventListener?b.addEventListener(a,h):b.addListener?b.addListener(a,h):b.attachEvent(a,h);d&&d.register(i)})};f.whenAll=function(){var b={},a;if(arguments.length==1){var d=arguments[0];f.isTask(d)?(b[0]=d,a=!0):(b=d,a=Object.prototype.toString.call(b)==="[object Array]")}else{for(d=0;d<arguments.length;d++)b[d]=arguments[d];a=!0}return f.create(function(d){var c={},h;for(h in b)if(b.hasOwnProperty(h)){var i=b[h];f.isTask(i)&&(c[i.id]=h)}for(var g in c)i=b[c[g]],i.status=="ready"&&i.start();
for(g in c)if(i=b[c[g]],i.error){d.complete("failure",i.error);return}var j=a?[]:{},k=function(){if(this.error){for(var a in c)b[c[a]].removeEventListener("complete",k);d.complete("failure",this.error)}else j[c[this.id]]=this.result,delete c[this.id],l--,l==0&&d.complete("success",j)},l=0;for(g in c)h=c[g],i=b[h],i.status=="succeeded"?(j[h]=i.result,delete c[i.id]):(l++,i.addEventListener("complete",k));l==0&&d.complete("success",j)})};f.whenAny=function(){var b={};if(arguments.length==1){var a=arguments[0];
f.isTask(a)?b[0]=a:b=a}else for(a=0;a<arguments.length;a++)b[a]=arguments[a];return f.create(function(a){var e={},c;for(c in b)if(b.hasOwnProperty(c)){var h=b[c];f.isTask(h)&&(e[h.id]=c)}for(var i in e)h=b[e[i]],h.status=="ready"&&h.start();for(i in e)if(c=e[i],h=b[c],h.error||h.status=="succeeded"){a.complete("success",{key:c,task:h});return}var g=function(){for(var c in e)b[e[c]].removeEventListener("complete",g);a.complete("success",{key:e[this.id],task:this})};for(i in e)b[e[i]].addEventListener("complete",
g)})};if(!g.Jscexify)g.Jscexify={};g=g.Jscexify;g.fromStandard=function(b){var a=m(arguments);return function(){var d=this,e=n(arguments,b.length-1);return f.create(function(c){e.push(function(b,d){if(b)c.complete("failure",b);else if(a){for(var f={},e=0;e<a.length;e++)f[a[e]]=arguments[e+1];return c.complete("success",f)}else c.complete("success",d)});b.apply(d,e)})}};f.prototype.then=f.prototype.continueWith=function(b){var a=this;return f.create(function(d){var e=function(){this.error?d.complete("failure",
this.error):d.complete("success",this.result)},c=function(){if(this.error)return d.complete("failure",this.error);var a;try{a=b(this.result)}catch(c){return d.complete("failure",c)}a.status=="ready"&&a.start();a.status=="running"?a.addEventListener("complete",e):e.call(a)};a.status=="ready"&&a.start();a.status=="running"?a.addEventListener("complete",c):c.call(a)})};g.fromCallback=function(b){var a=m(arguments);return function(){var d=this,e=n(arguments,b.length-1);return f.create(function(c){e.push(function(b){if(a){for(var d=
{},e=0;e<a.length;e++)d[a[e]]=arguments[e];c.complete("success",d)}else c.complete("success",b)});b.apply(d,e)})}};j.modules["async-powerpack"]=!0}},o=typeof define==="function"&&!define.amd,p=typeof require==="function"&&typeof define==="function"&&define.amd;if(typeof require==="function"&&typeof module!=="undefined"&&module.exports)module.exports.init=l;else if(o)define("jscex-async-powerpack",["jscex-async"],function(j,g,f){f.exports.init=l});else if(p)define("jscex-async-powerpack",["jscex-async"],
function(){return{init:l}});else{if(typeof Jscex==="undefined")throw Error('Missing the root object, please load "jscex" module first.');l(Jscex)}})();
